<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Split Smart LIFIN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  
  <style>
    body {
        font-family: 'Baloo 2', sans-serif;
    }
    .hidden {
        display: none;
    }
    .drop-zone {
        transition: background-color 0.3s, border-color 0.3s, transform 0.2s;
    }
    .drop-zone.drag-over {
        background-color: #e0f7fa;
        border-color: #06b6d4;
    }
    .drop-zone.correct-drop {
        border-color: #22c55e;
        background-color: #dcfce7;
        transform: scale(1.05);
    }
    .drop-zone.wrong-drop {
        border-color: #ef4444;
        background-color: #fee2e2;
        transform: scale(1.05);
    }
    .draggable-item {
        cursor: grab;
    }
    .draggable-item:active {
        cursor: grabbing;
    }
    .clickable-zone {
        cursor: pointer;
        transition: transform 0.2s;
    }
    .clickable-zone:hover {
        transform: scale(1.03);
    }
  </style>
</head>
<body class="bg-[#04B3E3] flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl">
        <div id="sort-screen" class="bg-white rounded-3xl p-6 sm:p-8 text-center">
            <h1 class="text-3xl font-extrabold text-[#006F8D] mb-4">Sortir Kebutuhan & Keinginan!</h1>
            <p id="instruction-text" class="text-gray-600 mb-6">Seret barang di bawah ke kotak yang benar.</p>
            
            <div id="item-display-area" class="bg-gray-100 rounded-2xl min-h-[200px] flex items-center justify-center mb-6 p-4">
                <div id="draggable-item" draggable="true" class="draggable-item bg-white p-4 rounded-lg shadow-md flex flex-col items-center gap-3 transition-transform transform">
                    <img id="item-image" src="" alt="Gambar Barang" class="h-32 w-32 object-contain rounded-md bg-gray-200">
                    <p id="item-text" class="text-xl font-bold text-gray-800 text-center">Memuat...</p>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-6 justify-center">
                <div id="needs-zone" data-type="Kebutuhan" class="drop-zone flex-1 bg-blue-100 border-4 border-dashed border-blue-300 rounded-2xl p-4 min-h-[150px] flex items-center justify-center">
                    <h2 class="text-2xl font-bold text-blue-800">Kebutuhan</h2>
                </div>
                <div id="wants-zone" data-type="Keinginan" class="drop-zone flex-1 bg-purple-100 border-4 border-dashed border-purple-300 rounded-2xl p-4 min-h-[150px] flex items-center justify-center">
                    <h2 class="text-2xl font-bold text-purple-800">Keinginan</h2>
                </div>
            </div>
            <div class="mt-6 text-2xl font-bold text-[#006F8D]">Skor: <span id="sort-score">0</span></div>
        </div>
        
        <div id="summary-screen" class="hidden bg-white rounded-3xl p-8 text-center">
            <h1 class="text-4xl font-extrabold text-[#006F8D] mb-2">Permainan Selesai!</h1>
            <div class="text-center max-w-md mx-auto mt-6">
                 <div class="bg-gray-100 p-6 rounded-lg">
                       <p class="text-lg text-gray-600">Skor Akhir</p>
                       <p id="summary-final-score" class="text-4xl font-bold text-[#006F8D]"></p>
                 </div>
            </div>

            <div class="my-8">
                <p class="text-gray-600 mb-3">Bagikan Hasilmu!</p>
                <div class="flex justify-center items-center gap-4">
                    <a id="share-tiktok" href="#" class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-white hover:opacity-80 transition-opacity" title="Bagikan ke TikTok">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-2.43.03-4.63-1.1-6.16-2.96-1.3-1.59-1.94-3.56-1.93-5.52.02-1.92 1.04-3.87 2.4-5.17 1.05-.99 2.3-1.66 3.65-2.02.38-.1.77-.18 1.16-.23 1.09-.14 2.18-.23 3.27-.35.02-2.68.01-5.36 0-8.04z"/></svg>
                    </a>
                    <a id="share-instagram" href="#" class="w-12 h-12 bg-gradient-to-br from-purple-600 via-pink-600 to-yellow-500 rounded-full flex items-center justify-center text-white hover:opacity-80 transition-opacity" title="Bagikan ke Instagram">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664-4.771 4.919-4.919 1.266-.058 1.644-.07 4.85-.07zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.058-1.689-.072-4.948-.072zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44 1.441-.645 1.441-1.44-.645-1.44-1.441-1.44z"/></svg>
                    </a>
                    <a id="share-telegram" href="#" target="_blank" class="w-12 h-12 bg-[#2AABEE] rounded-full flex items-center justify-center text-white hover:opacity-80 transition-opacity" title="Bagikan ke Telegram">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.08l11.1-4.16c.71-.26 1.36.21 1.15.91L14.8 19.21c-.19.7-.74.83-1.28.53l-3.57-2.64-1.68 1.62c-.19.19-.38.31-.59.31z"/></svg>
                    </a>
                    <a id="share-email" href="#" class="w-12 h-12 bg-gray-500 rounded-full flex items-center justify-center text-white hover:opacity-80 transition-opacity" title="Bagikan via Email">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"/></svg>
                    </a>
                </div>
            </div>

            <div class="flex justify-center items-center gap-4">
                <button id="play-again-btn" class="bg-[#FFD635] text-[#004b75] font-bold text-xl py-3 px-10 rounded-xl shadow-lg hover:scale-105 transition-transform">Main Lagi</button>
            </div>
        </div>

    </div>

    <audio id="correct-sound" src="/lifin/games/finance-quiz-race/assets/Audio/Benar.mp3" preload="auto"></audio>
    <audio id="wrong-sound" src="/lifin/games/finance-quiz-race/assets/Audio/Salah.mp3" preload="auto"></audio>
    <audio id="win-sound" src="/lifin/games/finance-quiz-race/assets/Audio/Menang Akhir.mp3" preload="auto"></audio>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let allSortItems = [];
        let gameItems = [];
        let currentSortIndex = 0;
        let sortScore = 0;
        let currentDragItem = null;
        const TOTAL_SORT_ITEMS = 10;
        let isInteractionDisabled = false;

        const sortScreen = document.getElementById('sort-screen');
        const summaryScreen = document.getElementById('summary-screen');
        const draggableItemEl = document.getElementById('draggable-item');
        const itemImageEl = document.getElementById('item-image');
        const itemTextEl = document.getElementById('item-text');
        const needsZoneEl = document.getElementById('needs-zone');
        const wantsZoneEl = document.getElementById('wants-zone');
        const sortScoreEl = document.getElementById('sort-score');
        const instructionTextEl = document.getElementById('instruction-text');
        const playAgainBtn = document.getElementById('play-again-btn');

        // PENAMBAHAN: Referensi Audio & Share
        const correctSound = document.getElementById('correct-sound');
        const wrongSound = document.getElementById('wrong-sound');
        const winSound = document.getElementById('win-sound');
        const shareTiktokBtn = document.getElementById('share-tiktok');
        const shareInstagramBtn = document.getElementById('share-instagram');
        const shareTelegramBtn = document.getElementById('share-telegram');
        const shareEmailBtn = document.getElementById('share-email');

        async function loadSortData() {
            try {
                const response = await fetch('./data/soal-sotirkebutuhankeinginan-financequizrace.json');
                if (!response.ok) {
                    throw new Error(`Gagal memuat data: ${response.statusText}`);
                }
                allSortItems = await response.json();
            } catch (error) {
                console.error("Gagal memuat data soal:", error);
                itemTextEl.textContent = "Gagal memuat soal.";
                draggableItemEl.style.display = 'none';
            }
        }

        function showScreen(screenElement) {
            sortScreen.classList.add('hidden');
            summaryScreen.classList.add('hidden');
            screenElement.classList.remove('hidden');
        }

        function startGame() {
            if (allSortItems.length === 0) {
                itemTextEl.textContent = "Data soal tidak ditemukan.";
                return;
            };
            
            gameItems = [...allSortItems].sort(() => 0.5 - Math.random()).slice(0, TOTAL_SORT_ITEMS);
            currentSortIndex = 0;
            sortScore = 0;
            isInteractionDisabled = false;
            sortScoreEl.textContent = sortScore;
            
            displaySortItem();
            showScreen(sortScreen);
        }

        function endGame() {
            // PENAMBAHAN: Suara Kemenangan & Konfeti
            winSound.currentTime = 0;
            winSound.play();
            confetti({ particleCount: 100, spread: 70, origin: { x: 0, y: 0.7 }, angle: 60 });
            confetti({ particleCount: 100, spread: 70, origin: { x: 1, y: 0.7 }, angle: 120 });
            
            document.getElementById('summary-final-score').textContent = `${sortScore} / ${TOTAL_SORT_ITEMS}`;
            showScreen(summaryScreen);

            // PENAMBAHAN: Update Link Share
            const shareText = `Aku baru saja menyelesaikan game Split Smart dan dapat skor ${sortScore}/${TOTAL_SORT_ITEMS}! Kamu bisa bedain kebutuhan dan keinginan nggak?`;
            shareTelegramBtn.href = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(shareText)}`;
            shareEmailBtn.href = `mailto:?subject=Hasil Game Split Smart LIFIN&body=${encodeURIComponent(shareText)}`;
        }

        function displaySortItem() {
            if (currentSortIndex >= TOTAL_SORT_ITEMS) {
                setTimeout(endGame, 500);
                return;
            }
            currentDragItem = gameItems[currentSortIndex];
            
            itemTextEl.textContent = currentDragItem.Barang;
            itemImageEl.src = currentDragItem['Link Gambar'];
            itemImageEl.onerror = function() {
                this.onerror=null;
                this.src=`https://placehold.co/128x128/e2e8f0/475569?text=Gambar\\nError`;
            };

            draggableItemEl.dataset.id = currentDragItem.No;
            instructionTextEl.textContent = `Barang ${currentSortIndex + 1} dari ${TOTAL_SORT_ITEMS}`;
        }

        function processAnswer(chosenType) {
            if (!currentDragItem || isInteractionDisabled) return;

            isInteractionDisabled = true;
            const correct = currentDragItem.Jawaban === chosenType;
            const zoneEl = chosenType === 'Kebutuhan' ? needsZoneEl : wantsZoneEl;

            if (correct) {
                sortScore++;
                zoneEl.classList.add('correct-drop');
                // PENAMBAHAN: Suara Benar
                correctSound.currentTime = 0;
                correctSound.play();
            } else {
                zoneEl.classList.add('wrong-drop');
                // PENAMBAHAN: Suara Salah
                wrongSound.currentTime = 0;
                wrongSound.play();
            }
            sortScoreEl.textContent = sortScore;
            
            setTimeout(() => {
                zoneEl.classList.remove('correct-drop', 'wrong-drop');
                currentSortIndex++;
                displaySortItem();
                isInteractionDisabled = false;
            }, 1200);
        }

        function handleDragStart(e) {
            if (currentDragItem) {
                e.dataTransfer.setData('text/plain', currentDragItem.No);
                setTimeout(() => e.target.classList.add('opacity-50'), 0);
            } else {
                e.preventDefault();
            }
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('opacity-50');
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropZone = e.currentTarget;
            const dropType = dropZone.dataset.type;
            dropZone.classList.remove('drag-over');
            processAnswer(dropType);
        }

        function handleChoiceClick(e) {
            const choiceType = e.currentTarget.dataset.type;
            processAnswer(choiceType);
        }

        async function init() {
            playAgainBtn.addEventListener('click', () => {
                // PENAMBAHAN: Hentikan suara menang saat main lagi
                winSound.pause();
                winSound.currentTime = 0;
                startGame();
            });

            // PENAMBAHAN: Event listener untuk share TikTok & Instagram
            shareTiktokBtn.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Bagikan screenshot hasilmu ke TikTok!');
            });
    
            shareInstagramBtn.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Bagikan screenshot hasilmu ke Instagram!');
            });

            await loadSortData();

            if (window.innerWidth < 768) {
                instructionTextEl.textContent = "Pilih kotak 'Kebutuhan' atau 'Keinginan' untuk menjawab.";
                draggableItemEl.draggable = false;
                draggableItemEl.style.cursor = 'default';
                needsZoneEl.addEventListener('click', handleChoiceClick);
                wantsZoneEl.addEventListener('click', handleChoiceClick);
                needsZoneEl.classList.add('clickable-zone');
                wantsZoneEl.classList.add('clickable-zone');
            } else {
                instructionTextEl.textContent = "Seret barang di bawah ke kotak yang benar.";
                draggableItemEl.addEventListener('dragstart', handleDragStart);
                draggableItemEl.addEventListener('dragend', handleDragEnd);

                [needsZoneEl, wantsZoneEl].forEach(zone => {
                    zone.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        if (!isInteractionDisabled) zone.classList.add('drag-over');
                    });
                    zone.addEventListener('dragleave', (e) => {
                        e.currentTarget.classList.remove('drag-over');
                    });
                    zone.addEventListener('drop', handleDrop);
                });
            }
            
            startGame();
        }
        
        init();
    });
    </script>
</body>
</html>